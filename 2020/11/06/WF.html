
<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>My F1Tenth journey</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="My F1Tenth journey.">
    <link rel="canonical" href="http://smejkka3.github.io/">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="My F1Tenth journey" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

</head>
    <body>

    <header class="site-header">

  <div class="wrap">

    <div style="float:left; margin-top:10px; margin-right:10px;">
    <a href="/index.html">
      <img src="/img/icon.png" width="40">
    </a>
    </div>

    <a class="site-title" href="/">My F1Tenth journey</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
          <a href="/CV_2020.pdf">Curriculum Vitae<i class="far fa-file"></i></i></a>









      </div>
    </nav>
  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Wallfollowing</h1>
    <p class="meta">6 Nov 2020</p>
  </header>

  <article class="post-content">
  <h3 id="intro">Introduction</h3>
  <p>
  Lecture 3 as prerequisite for wallfollowing algorithm covers one of the last ROS intruductory topic as that are Rigid Body Transformation.
  Coordinate frames in ros such as map frame, lidar frame and other sensors provide informations specific to that sensor. Coordinate frame is
  set of 3 orthogonal axes for X,Y and Z direction with a position where this frame is placed. Any poistion of word, robot, etc. only makes sense
  when we defined the frame in which we are describing the pose. The direction of X,Y, Z axes is defined by right-handed rule, where index finger points in
  X direction, middle finger in y direction and thumb in Z direction. Lets look more into transfomations and frames.
  </p>
  <h3 id="trans_frames">Transfomations and Frames</h3>
  <p>
  Why do we need transformations between different sensors? Each time I get data in sensor frame (for specific sensor) which I want to transform in some unified way.
  FOr example we can have frame of reference of lidar which we can transform into the frame of reference of robot, which is the center of the rear axle. As example in
  the last assignment we only take in account the frame of reference of lidar and stopped the car based on position of the lidar. However car have certain legnth and lidar
  can be place in the center of the car. Therefore the correct way of stopping before collision should be calculated from the front of the car (or edge of the car), not from the
  position of the lidar. Between frames there will exist transofmation taht convert measurent from one frame to another.
  </p>
  <h3 id="f1_frames">Reference Frames on F1Tenth car</h3>
  <p>
    <ul>
      <li>map
        <p>
          The origin set by the user and every other transformation can be measured with respect to the map. Represent the enviroment where
          the car will be racing. Can be place arbitrary and typically never moves after its placed.
        </p>
      <li>base_link
        <p>
          Positioned at center of the rear axle of the car. Moves with the car relative to the map frame.
        </p>
      <li>lidar
        <p>
          The frame of reference where lidar scan measurements are taken. Moves with the car relative to the map frame.
        </p>
      <li>odom
        <p>
          Typically required by ROS. Usually the initial position of the robot in the map before everything began. Fixed relative to the map.
        </p>
    </ul>
  </p>
  <h4 id="rbt">Rigid Body Transfomation</h4>
  <p>
    How to transform data and postition between one frame and anohter. As on figure bellow, we want the coordinate of point p in frame 2, given the coordinate of point p in frame 1.
  </p>
      <div class="imgcap">
      <div style="display:inline-block">
      <img src="/img/frames.png" alt="frames", height="200">
      <div class="thecap">2 diffrent coordinate frames and point p from<a href="https://linklab-uva.github.io/autonomousracing/assets/files/ROS-tf.pdf">UV F1/10 course</a></div>
      </div></div>
    Steps:
    <ol>
      <li> Overlap both frames so their origins are at the same point. The reason is that we want to compute how is second frame of reference rotated. (apply rotation)
      <li> Describe the unit vectors of the second frame of reference in the terms of unit vectors of first frame of reference. As on picture bellow.
        <div class="imgcap">
        <div style="display:inline-block">
        <img src="/img/frames2.png" alt="frames", height="200">
        <div class="thecap">Overlapped frames of reference from<a href="https://linklab-uva.github.io/autonomousracing/assets/files/ROS-tf.pdf">UV F1/10 course</a></div>
        </div></div>
        <p>
          x<sub>2</sub> = R<sub>11</sub>x<sub>1</sub> + R<sub>21</sub> y<sub>1</sub><br>
          y<sub>2</sub> = R<sub>12</sub>x<sub>1</sub> + R<sub>22</sub> y<sub>1</sub><br>
          The formula above describes the units vector of new frame of referece as a linear combination of the original frame of reference. (considering only X,Y axis - 2D problem, no Z).
          The formula can be also rewriten as matrix:
         </p>
         <div class="imgcap">
         <div style="display:inline-block">
         <img src="/img/rotation_matrix.png" alt="matrix", height="100">
         <div class="thecap">Rotation matrix from<a href="https://linklab-uva.github.io/autonomousracing/assets/files/ROS-tf.pdf">UV F1/10 course</a></div>
         </div></div>
         <p>
        Also we define &theta; as angle between x<sub>1</sub> and x<sub>2</sub> as shown on figure bellow. This angle tells us how rotated this frame is.
        </p>
        <div class="imgcap">
        <div style="display:inline-block">
        <img src="/img/theta.png" alt="theta", height="200">
        <div class="thecap">Overlapped frames of reference with angle theta from<a href="https://linklab-uva.github.io/autonomousracing/assets/files/ROS-tf.pdf">UV F1/10 course</a></div>
        </div></div>
        <p>
        To get the coefficients R<sub>11</sub>, R<sub>21</sub>, R<sub>12</sub>, R<sub>22</sub>, along x<sub>2</sub> unit vector direction, contains the cos unit component of x<sub>1</sub>
        unit vector as well as sin component of y<sub>1</sub> unit vector. Thefore  x<sub>2</sub> and similary y<sub>2</sub> can be written as:
        </p>
        <p>
        x<sub>2</sub> = cos(&theta;)x<sub>1</sub> + sin(&theta;)y<sub>1</sub><br>
        y<sub>2</sub> = -sin(&theta;)x<sub>1</sub> + cos(&theta;)y<sub>1</sub><br>
        </p>
        <p>
          Therefore I get:
        </p>
          <div class="imgcap">
          <div style="display:inline-block">
          <img src="/img/rotation_matrix2.png" alt="matrix2", height="100">
          <div class="thecap">Rotation matrix from<a href="https://linklab-uva.github.io/autonomousracing/assets/files/ROS-tf.pdf">UV F1/10 course</a></div>
          </div></div>
    </ol>
    <p>
      With this we are able to represent unit vectors in the new frame of reference in terms of unit vectors of original frame of reference.
      Similary we can express the position of point P in the new frame of reference using the rotation matrix as shown on formulas bellow.
    </p>
      <div class="imgcap">
      <div style="display:inline-block">
      <img src="/img/rotation_p.png" alt="matrix_p", height="100">
      <div class="thecap">Rotation matrix of point p from<a href="https://linklab-uva.github.io/autonomousracing/assets/files/ROS-tf.pdf">UV F1/10 course</a></div>
      </div></div>
      <p>
        We can't forget to apply the translation as well.
      </p>
  <h3 id="wf">Wallfollowing</h3>
  The idea is we are trying to compute the error between the future position of the car instead of current error because of constant movement of the car.
  By minimizing the future distance from the wall with respect to the optimal trajectory we are able to follow the wall.
  TODO DESCRIBE MY IMPLEMENTATION AS THE ALGORITHM
  <h3 id="lab3">F1Tenth Lab3 assignment </h3>

  </article>

  <!-- mathjax -->


  <!-- disqus comments -->

  <div id="disqus_thread"></div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://smejkka3-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <div class="footer-col-1 column">
      <ul>
        <li>Karel Smejkal blog</li>
        <!-- <li><a href="mailto:"></a></li> -->
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/smejkka3">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">smejkka3</span>
          </a>
        </li>
        <li>
          <a href="http://twitter.com/KarelSmejkal">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="2" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username">KarelSmejkal</span>
          </a>
        </li>
        <li>
          <a href="https://www.linkedin.com/in/karel-smejkal/">
            <span class="icon linkedin">
            <svg class="linkedin" fill="#000000" height="16" viewBox="0 0 24 24" enable-background="new 0 0 16 16" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
              <path  fill="#C2C2C2" d="M19,19H16V13.7A1.5,1.5 0 0,0 14.5,12.2A1.5,1.5 0 0,0 13,13.7V19H10V10H13V11.2C13.5,10.36
              14.59,9.8 15.5,9.8A3.5,3.5 0 0,1 19,13.3M6.5,8.31C5.5,8.31 4.69,7.5 4.69,6.5A1.81,1.81 0 0,1 6.5,4.69C7.5,4.69 8.31,5.5
              8.31,6.5A1.81,1.81 0 0,1 6.5,8.31M8,19H5V10H8M20,2H4C2.89,2 2,2.89 2,4V20A2,2 0 0,0 4,22H20A2,2 0 0,0 22,20V4C22,2.89
              21.1,2 20,2Z"/>
            </svg>
            </span>
            <span class="username">karel-smejkal</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">My F1Tenth journey.</p>
    </div>

  </div>

</footer>
    </body>
</html>
